From 200249e6543b5856977e2e904aa5ed5ddf18b867 Mon Sep 17 00:00:00 2001
From: Ben Smith-Mannschott <bsmith.occs@gmail.com>
Date: Sat, 15 Oct 2011 17:33:39 +0200
Subject: [PATCH] CLJ-851: add regression test

---
 src/script/run_tests.clj              |    1 +
 test/clojure/test_clojure/clj_851.clj |   25 +++++++++++++++++++++++++
 2 files changed, 26 insertions(+), 0 deletions(-)
 create mode 100644 test/clojure/test_clojure/clj_851.clj

diff --git a/src/script/run_tests.clj b/src/script/run_tests.clj
index 6720abd..394f01f 100644
--- a/src/script/run_tests.clj
+++ b/src/script/run_tests.clj
@@ -4,6 +4,7 @@
 clojure.test-clojure.agents
 clojure.test-clojure.annotations
 clojure.test-clojure.atoms
+clojure.test-clojure.clj-851
 clojure.test-clojure.clojure-set
 clojure.test-clojure.clojure-walk                       
 clojure.test-clojure.clojure-xml
diff --git a/test/clojure/test_clojure/clj_851.clj b/test/clojure/test_clojure/clj_851.clj
new file mode 100644
index 0000000..a3009a1
--- /dev/null
+++ b/test/clojure/test_clojure/clj_851.clj
@@ -0,0 +1,25 @@
+;   Copyright (c) Rich Hickey. All rights reserved.
+;   The use and distribution terms for this software are covered by the
+;   Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)
+;   which can be found in the file epl-v10.html at the root of this distribution.
+;   By using this software in any fashion, you are agreeing to be bound by
+;   the terms of this license.
+;   You must not remove this notice, or any other, from this software.
+
+(ns clojure.test-clojure.clj-851
+  (:use clojure.test clojure.test-helper
+        clojure.test-clojure.protocols))
+
+(deftest clj-851
+  (testing "Type-hinting a var with primitive array pseudo-class should not result in IllegalArgumentException when var is used as an arg."
+    (testing "This case fails without a fix for CLJ-851"
+      (is (eval-in-temp-ns
+           (def ^longs la (long-array 0))
+           (defn foo [] (alength la))
+           true)))
+    (testing "This case should pass even without a fix for CLJ-851"
+      (is (eval-in-temp-ns
+           (def ^"[J" la (long-array 0))
+           (defn foo [] (alength la))
+           true)))))
+
-- 
1.7.6.1

